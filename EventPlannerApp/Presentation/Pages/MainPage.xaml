<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="EventPlannerApp.Presentation.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Background="{StaticResource LightViolet2}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="Label">
                <Setter Property="TextColor" Value="AntiqueWhite" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowSpacing="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="50" />
            <RowDefinition Height="*" />
            <RowDefinition Height="70" />
        </Grid.RowDefinitions>

        <HorizontalStackLayout Grid.Row="0" Spacing="10">
            <Border
                Grid.Row="0"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 20">
                <SearchBar
                    x:Name="EventSearchBar"
                    Background="{StaticResource LightViolet3}"
                    Placeholder="Event suchen..."
                    PlaceholderColor="WhiteSmoke"
                    SearchCommand="{Binding SearchCommand}"
                    TextChanged="OnEventSearchTextChanged"
                    TextColor="WhiteSmoke"
                    WidthRequest="330" />
            </Border>
            <ImageButton
                BackgroundColor="Transparent"
                Clicked="OnQrSearchButton_Clicked"
                HeightRequest="50"
                Source="qr_icon.png"
                WidthRequest="50" />
        </HorizontalStackLayout>
        <StackLayout Grid.Row="1">

            <CollectionView
                x:Name="EventsCollectionView"
                HorizontalOptions="FillAndExpand"
                HorizontalScrollBarVisibility="Never"
                ItemsSource="{Binding FilteredEvents}"
                SelectionChanged="OnEventSelected"
                SelectionMode="Single">

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout ItemSpacing="10" Orientation="Horizontal" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>

                        <Border Stroke="Transparent" StrokeShape="RoundRectangle 20">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Offset="0.1" Color="#660066" />
                                    <GradientStop Offset="1.0" Color="#cc0099" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <Grid>
                                <VerticalStackLayout Padding="10" Spacing="10">

                                    <VerticalStackLayout>
                                        <Label
                                            FontSize="10"
                                            Text="{Binding Id, StringFormat='Event-ID:{0}'}"
                                            VerticalOptions="Center" />
                                        <Label
                                            FontSize="30"
                                            Text="{Binding Name}"
                                            VerticalOptions="Center" />
                                    </VerticalStackLayout>
                                    <Image
                                        Aspect="AspectFill"
                                        HeightRequest="200"
                                        Source="{Binding ImageIndex, StringFormat='event{0}.png'}"
                                        VerticalOptions="Center"
                                        WidthRequest="200" />
                                    <HorizontalStackLayout>
                                        <Image
                                            HeightRequest="30"
                                            Source="location_symbol.png"
                                            WidthRequest="30" />
                                        <Label
                                            FontAttributes="Bold"
                                            FontSize="18"
                                            Text="{Binding Location}"
                                            VerticalTextAlignment="Center" />
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout>
                                        <Image
                                            HeightRequest="30"
                                            Source="calendar_symbol.png"
                                            WidthRequest="30" />
                                        <Label
                                            FontAttributes="Bold"
                                            FontSize="16"
                                            Text="{Binding Date}"
                                            VerticalTextAlignment="Center" />
                                    </HorizontalStackLayout>
                                    <Label FontSize="16" Text="{Binding OrganizerId, Converter={StaticResource UserIdsToNamesConverter}, StringFormat='von {0}'}" />
                                    <FlexLayout Direction="Row" Wrap="Wrap">
                                        <CollectionView ItemsSource="{Binding Tags}" SelectionMode="None">
                                            <CollectionView.ItemsLayout>
                                                <LinearItemsLayout ItemSpacing="10" Orientation="Horizontal" />
                                            </CollectionView.ItemsLayout>
                                            <CollectionView.ItemTemplate>
                                                <DataTemplate>
                                                    <Label
                                                        FontSize="Medium"
                                                        LineBreakMode="WordWrap"
                                                        Text="{Binding StringFormat='#{0}'}" />
                                                </DataTemplate>
                                            </CollectionView.ItemTemplate>
                                        </CollectionView>
                                    </FlexLayout>
                                    <Label
                                        FontSize="24"
                                        Text="{Binding Rating, Converter={StaticResource RatingToStarsConverter}}"
                                        TextColor="Gold" />
                                    <!--<Image Grid.Row="4"
                                   Source="qr_icon.png"
                                   HeightRequest="100"
                                             MaximumHeightRequest="100"
                                   VerticalOptions="Center"
                                             Aspect="AspectFit"
                                             BackgroundColor="Transparent">
                                    <Image.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnQrButton_Clicked"/>
                                    </Image.GestureRecognizers>
                                </Image>-->
                                </VerticalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>


        <Button
            Grid.Row="2"
            Margin="10,10,10,10"
            Padding="10,10,10,10"
            Clicked="OnAddEvent_Clicked"
            CornerRadius="10"
            FontSize="20"
            HorizontalOptions="FillAndExpand"
            Text="Neues Event"
            TextColor="White"
            VerticalOptions="CenterAndExpand">
            <Button.Background>
                <LinearGradientBrush StartPoint="1,1" EndPoint="1,1">
                    <GradientStop Offset="0.1" Color="#003300" />
                    <GradientStop Offset="1.0" Color="#336600" />
                </LinearGradientBrush>
            </Button.Background>
        </Button>

    </Grid>

</ContentPage>
